(self.webpackChunk_site_blog=self.webpackChunk_site_blog||[]).push([[9098],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return d},kt:function(){return c}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),m=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=m(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=m(t),c=a,f=p["".concat(s,".").concat(c)]||p[c]||u[c]||o;return t?r.createElement(f,l(l({ref:n},d),{},{components:t})):r.createElement(f,l({ref:n},d))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,l=new Array(o);l[0]=p;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var m=2;m<o;m++)l[m]=t[m];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},1018:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return m},toc:function(){return d},default:function(){return p}});var r=t(2122),a=t(9756),o=(t(7294),t(3905)),l=["components"],i={id:"vue_3_implement_a_change_password_modal",title:"\u4f7f\u7528 Vue 3 Composition API \u5b9e\u73b0\u4e00\u4e2a\u4fee\u6539\u5bc6\u7801\u5f39\u6846"},s=void 0,m={unversionedId:"vue/vue3/vue_3_implement_a_change_password_modal",id:"vue/vue3/vue_3_implement_a_change_password_modal",isDocsHomePage:!1,title:"\u4f7f\u7528 Vue 3 Composition API \u5b9e\u73b0\u4e00\u4e2a\u4fee\u6539\u5bc6\u7801\u5f39\u6846",description:"\u53c2\u8003\u94fe\u63a5",source:"@site/docs/vue/vue3/vue_3_implement_a_change_password_modal.md",sourceDirName:"vue/vue3",slug:"/vue/vue3/vue_3_implement_a_change_password_modal",permalink:"/blog/docs/vue/vue3/vue_3_implement_a_change_password_modal",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/vue/vue3/vue_3_implement_a_change_password_modal.md",version:"current",frontMatter:{id:"vue_3_implement_a_change_password_modal",title:"\u4f7f\u7528 Vue 3 Composition API \u5b9e\u73b0\u4e00\u4e2a\u4fee\u6539\u5bc6\u7801\u5f39\u6846"}},d=[{value:"\u53c2\u8003\u94fe\u63a5",id:"\u53c2\u8003\u94fe\u63a5",children:[]},{value:"\u5206\u6790\u548c\u8bbe\u8ba1",id:"\u5206\u6790\u548c\u8bbe\u8ba1",children:[{value:"\u5047\u60f3\u573a\u666f",id:"\u5047\u60f3\u573a\u666f",children:[]},{value:"\u5206\u6790\u573a\u666f",id:"\u5206\u6790\u573a\u666f",children:[]},{value:"\u7b80\u8ff0\u8bbe\u8ba1",id:"\u7b80\u8ff0\u8bbe\u8ba1",children:[]}]},{value:"\u5b9e\u73b0\u4ee3\u7801",id:"\u5b9e\u73b0\u4ee3\u7801",children:[{value:"\u8c03\u7528\u4f4d\u7f6e\u7684\u4ee3\u7801",id:"\u8c03\u7528\u4f4d\u7f6e\u7684\u4ee3\u7801",children:[]},{value:"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e\u7684\u4ee3\u7801",id:"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e\u7684\u4ee3\u7801",children:[]}]}],u={toc:d};function p(e){var n=e.components,t=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"\u53c2\u8003\u94fe\u63a5"},"\u53c2\u8003\u94fe\u63a5"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://v3.vuejs.org/api/composition-api.html#setup"},"Composition API - setup")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://v3.vuejs.org/guide/component-props.html"},"component props")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://2x.antdv.com/components/form-cn#components-form-demo-useForm-basic"},"useForm \u57fa\u672c\u8868\u5355")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@ant-design-vue/use"},"@ant-design-vue/use"))),(0,o.kt)("h2",{id:"\u5206\u6790\u548c\u8bbe\u8ba1"},"\u5206\u6790\u548c\u8bbe\u8ba1"),(0,o.kt)("h3",{id:"\u5047\u60f3\u573a\u666f"},"\u5047\u60f3\u573a\u666f"),(0,o.kt)("p",null,"\u5047\u60f3\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u4e24\u4e2a\u4fee\u6539\u5bc6\u7801\u7684\u5f39\u6846\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5728\u9996\u6b21\u767b\u5f55\u65f6\uff0c\u91cd\u7f6e\u521d\u59cb\u5bc6\u7801\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u5728\u7528\u6237\u767b\u5f55\u540e\uff0c\u4fee\u6539\u5bc6\u7801\u3002")),(0,o.kt)("p",null,"\u4e3a\u4e86\u533a\u522b\u8fd9\u4e24\u4e2a\u5f39\u6846\uff0c\u6211\u4eec\u5c06\u5f39\u6846\u5206\u522b\u547d\u540d\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"\u91cd\u7f6e\u521d\u59cb\u5bc6\u7801\u5f39\u6846")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"\u4fee\u6539\u5bc6\u7801\u5f39\u6846"),"\u3002"),(0,o.kt)("h3",{id:"\u5206\u6790\u573a\u666f"},"\u5206\u6790\u573a\u666f"),(0,o.kt)("p",null,"\u4e24\u4e2a\u5f39\u6846\u7684\u5171\u540c\u70b9\u662f\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u90fd\u6709\u65e7\u7684\u5bc6\u7801\u3001\u65b0\u7684\u5bc6\u7801\u3001\u786e\u8ba4\u5bc6\u7801\u4e09\u4e2a\u8f93\u5165\u6846\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u9a8c\u8bc1\u903b\u8f91\u76f8\u540c\uff08\u4e09\u4e2a\u5bc6\u7801\u6846\u90fd\u5fc5\u586b\u3001\u65b0\u7684\u5bc6\u7801\u548c\u786e\u8ba4\u5bc6\u7801\u8981\u6c42\u8f93\u5165\u4e00\u81f4\uff09\u3002")),(0,o.kt)("p",null,"\u4e24\u4e2a\u5f39\u6846\u7684\u5dee\u5f02\u70b9\u662f\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u91cd\u7f6e\u521d\u59cb\u5bc6\u7801\u5f39\u6846\u3002\u8981\u6c42\u5f3a\u5236\u4fee\u6539\u5bc6\u7801\uff0c\u4e0d\u5141\u8bb8\u5173\u95ed\u5f39\u6846\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u4fee\u6539\u5bc6\u7801\u5f39\u6846\u3002\u4e0d\u5141\u8bb8\u5173\u95ed\u5f39\u6846\u3002")),(0,o.kt)("h3",{id:"\u7b80\u8ff0\u8bbe\u8ba1"},"\u7b80\u8ff0\u8bbe\u8ba1"),(0,o.kt)("p",null,"\u6211\u4eec\u628a\u7ec4\u4ef6\u5212\u5206\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"\u8c03\u7528\u4f4d\u7f6e")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e"),"\u3002"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"isInitialPassword \u63a7\u5236\u662f\u5426\u91cd\u7f6e\u521d\u59cb\u5bc6\u7801\u3002\u6211\u4eec\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u8c03\u7528\u4f4d\u7f6e")," \u7684 setup \u4e2d\u901a\u8fc7 setTimeout \u4e2d\u8bbe\u7f6e isInitialPassword.value=true \u5b9e\u73b0\u6a21\u62df\u5f02\u6b65\u83b7\u53d6\u53c2\u6570\u7684\u529f\u80fd\u3002"),(0,o.kt)("li",{parentName:"ol"},"prop \u4f20\u5165\u53c2\u6570\u3002\u6211\u4eec\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u8c03\u7528\u4f4d\u7f6e")," \u901a\u8fc7 props \u63a7\u5236\uff1a1. \u6807\u9898 title\u3002 2. \u662f\u5426\u53ef\u4ee5\u70b9\u51fb\u906e\u7f69\u5c42\u5173\u95ed\u5f39\u6846 maskClosable\u3002 3. \u662f\u5426\u663e\u793a\u5173\u95ed\u6309\u94ae closable\u3002"),(0,o.kt)("li",{parentName:"ol"},"ref \u83b7\u53d6\u7ec4\u4ef6\u5b9e\u4f8b\u3002\u6211\u4eec\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u8c03\u7528\u4f4d\u7f6e")," \u7684 mounted \u56de\u8c03\u4e2d\u901a\u8fc7 ref \u83b7\u53d6\u5f39\u6846\u7ec4\u4ef6\u5b9e\u4f8b\u3002"),(0,o.kt)("li",{parentName:"ol"},"state \u63a7\u5236\u663e\u9690\u3002\u6211\u4eec\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u8c03\u7528\u4f4d\u7f6e"),"\uff0c\u901a\u8fc7 ref \u62ff\u5230\u7ec4\u4ef6\u5b9e\u4f8b\uff0c\u7136\u540e\u4fee\u6539\u7ec4\u4ef6\u5185\u90e8 visible \u72b6\u6001\uff0c\u6765\u63a7\u5236\u5f39\u6846\u663e\u9690\u3002"),(0,o.kt)("li",{parentName:"ol"},"validate \u76f8\u5173\u7684\u903b\u8f91\u88ab\u5c01\u88c5\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e"),"\u3002\u6839\u636e ",(0,o.kt)("inlineCode",{parentName:"li"},"\u5173\u6ce8\u70b9\u5206\u79bb")," \u539f\u5219\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e")," \u5173\u6ce8\u9a8c\u8bc1\u903b\u8f91\uff0c",(0,o.kt)("inlineCode",{parentName:"li"},"\u8c03\u7528\u4f4d\u7f6e")," \u5173\u6ce8\u6570\u636e\u3002"),(0,o.kt)("li",{parentName:"ol"},"event \u63a5\u6536\u6570\u636e\u3002\u6211\u4eec\u5728 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e")," \u9a8c\u8bc1\u6570\u636e\u901a\u8fc7\u540e\uff0c\u4f7f\u7528 commit \u4e8b\u4ef6\u6765\u63a5\u6536 ",(0,o.kt)("inlineCode",{parentName:"li"},"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e")," \u7684\u6570\u636e oldPassword, newPassword\u3002")),(0,o.kt)("h2",{id:"\u5b9e\u73b0\u4ee3\u7801"},"\u5b9e\u73b0\u4ee3\u7801"),(0,o.kt)("h3",{id:"\u8c03\u7528\u4f4d\u7f6e\u7684\u4ee3\u7801"},"\u8c03\u7528\u4f4d\u7f6e\u7684\u4ee3\u7801"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <ChangePasswordDialog\n    ref="refResetPassword"\n    title="\u91cd\u7f6e\u521d\u59cb\u5bc6\u7801"\n    :maskClosable="false"\n    :closable="false"\n    @commit="resetPassword"\n  />\n  <ChangePasswordDialog\n    ref="refChangePassword"\n    title="\u4fee\u6539\u5bc6\u7801"\n    @commit="changePassword"\n  />\n</template>\n<script>\nimport { defineComponent, ref, watch } from \'vue\'\nimport ChangePasswordDialog from \'./change-password-modal/index.vue\'\n\nexport default defineComponent({\n  components: {\n    ChangePasswordDialog,\n  },\n  setup() {\n    // Composition API \u5f88\u65b9\u4fbf\uff0c\u53ef\u4ee5\u5728\u4ee3\u7801\u5c42\u9762\uff0c\u628a\u5bc6\u5207\u5173\u8054\u7684\u903b\u8f91\u653e\u7f6e\u5728\u63a5\u8fd1\u7684\u4f4d\u7f6e\n    \n    // \u4ee5\u4e0b\u662f\u5bc6\u5207\u5173\u8054\u7684\u5f02\u6b65\u63a7\u5236\u5f39\u6846\u663e\u9690\u903b\u8f91\uff0c\u653e\u7f6e\u5728\u4e00\u8d77\n    const isInitialPassword = ref(false)\n    watch(() => isInitialPassword.value, (value) => { // \u6211\u4eec\n      if (value) refResetPassword.value.visible = true\n    })\n    new Promise(function(resolve) { // \u8fd9\u91cc\u662f\u6d4b\u8bd5\u4ee3\u7801\uff0c\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u66ff\u6362\u4e3a\u5f02\u6b65\u8bf7\u6c42\u63a5\u53e3\u7684\u903b\u8f91\n      setTimeout(function () {\n        isInitialPassword.value = true\n        resolve()\n      }, 1000)\n    })\n\n    // \u4ee5\u4e0b\u662f\u5bc6\u5207\u5173\u8054\u7684\u4e8b\u4ef6\u63a5\u6536\u6570\u636e\u903b\u8f91\uff0c\u653e\u7f6e\u5728\u4e00\u8d77\n    const refResetPassword = ref(null)\n    const refChangePassword = ref(null)\n    const resetPassword = ({oldPassword, newPassword}) => {\n      console.log(oldPassword, newPassword)\n    }\n    const changePassword = ({oldPassword, newPassword}) => {\n      console.log(oldPassword, newPassword)\n    }\n\n    return {\n      refResetPassword,\n      refChangePassword,\n      resetPassword,\n      changePassword,\n    }\n  }\n})\n<\/script>\n')),(0,o.kt)("h3",{id:"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e\u7684\u4ee3\u7801"},"\u7ec4\u4ef6\u5b9e\u4f8b\u4f4d\u7f6e\u7684\u4ee3\u7801"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <a-modal\n    v-model:visible="visible"\n    :title="title"\n    :maskClosable="maskClosable"\n    :closable="closable"\n    :confirm-loading="loading"\n  >\n    <template #footer>\n      <a-button type="primary" @click="commit">\u786e\u5b9a</a-button>\n      <a-button @click="resetFields">\u91cd\u7f6e</a-button>\n    </template>\n    <a-form\n      ref="refForm"\n      :model="formState"\n      :label-col="labelCol"\n      :wrapper-col="wrapperCol"\n    >\n      <a-form-item v-bind="validateInfos.oldPassword" required has-feedback label="\u65e7\u7684\u5bc6\u7801">\n        <a-input autocomplete="off" type="password" v-model:value="formState.oldPassword" />\n      </a-form-item>\n      <a-form-item v-bind="validateInfos.newPassword" required has-feedback label="\u65b0\u7684\u5bc6\u7801">\n        <a-input autocomplete="off" type="password" v-model:value="formState.newPassword" />\n      </a-form-item>\n      <a-form-item v-bind="validateInfos.confirmPassword" required has-feedback label="\u786e\u8ba4\u5bc6\u7801">\n        <a-input autocomplete="off" type="password" v-model:value="formState.confirmPassword" />\n      </a-form-item>\n    </a-form>\n  </a-modal>\n</template>\n\n<script>\nimport { defineComponent, reactive, ref, toRaw } from \'vue\'\nimport { useForm } from \'@ant-design-vue/use\'\n\nexport default defineComponent({\n  name: \'ChangePasswordDialog\',\n  props: {\n    title: { default: \'\' },\n    maskClosable: { default: true },\n    closable: { default: true },\n  },\n  emits: [\'commit\'],\n  setup(props, { emit }) {\n    // \u4ee5\u4e0b\u662f\u5bc6\u5207\u5173\u8054\u7684\u5f39\u6846\u903b\u8f91\uff0c\u653e\u7f6e\u5728\u4e00\u8d77\n    const visible = ref(false)\n    const loading = ref(false)\n\n    // \u4ee5\u4e0b\u662f\u5bc6\u5207\u5173\u8054\u7684\u8868\u5355\u903b\u8f91\uff0c\u653e\u7f6e\u5728\u4e00\u8d77\n    const refForm = ref();\n    const formState = reactive({\n      oldPassword: \'\',\n      newPassword: \'\',\n      confirmPassword: \'\',\n    });\n    let validatePass = async (rule, value) => {\n      if (value === \'\') return Promise.reject(\'\u8bf7\u8f93\u5165\u65b0\u7684\u5bc6\u7801\');\n      if (formState.confirmPassword !== \'\') refForm.value.validateField(\'confirmPassword\');\n      return Promise.resolve();\n    };\n    let validatePass2 = async (rule, value) => {\n      if (value === \'\') return Promise.reject(\'\u8bf7\u518d\u6b21\u8f93\u5165\u65b0\u7684\u5bc6\u7801\');\n      if (value !== formState.newPassword) return Promise.reject("\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4\uff01");\n      return Promise.resolve();\n    };\n    const rules = reactive({\n      oldPassword: [{ required: true, trigger: \'change\', message: \'\u8bf7\u8f93\u5165\u65e7\u7684\u5bc6\u7801\' }],\n      newPassword: [{ validator: validatePass, trigger: \'change\' }],\n      confirmPassword: [{ validator: validatePass2, trigger: \'change\' }],\n    });\n    const { resetFields, validate, validateInfos } = useForm(formState, rules);\n    const commit = async () => {\n      try {\n        await validate()\n        emit(\'commit\', toRaw(formState))\n      } catch (error) {\n        console.log(\'error\', error);\n      }\n    }\n\n    return {\n      // modal\n      loading,\n      visible,\n\n      // form\n      refForm,\n      rules,\n      formState,\n      labelCol: { span: 5 },\n      wrapperCol: { span: 16 },\n      validateInfos,\n      resetFields,\n      commit,\n    }\n  }\n})\n<\/script>\n')))}p.isMDXComponent=!0}}]);