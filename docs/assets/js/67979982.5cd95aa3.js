(self.webpackChunk_site_blog=self.webpackChunk_site_blog||[]).push([[8988],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3744:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var a=n(2122),o=n(9756),r=(n(7294),n(3905)),i=["components"],l={},s='How To Build a "Hello World" Application with Koa',p={unversionedId:"core/server/how_to_build_a_hello_world_application_with_koa_en",id:"core/server/how_to_build_a_hello_world_application_with_koa_en",isDocsHomePage:!1,title:'How To Build a "Hello World" Application with Koa',description:"Introduction",source:"@site/docs/core/server/how_to_build_a_hello_world_application_with_koa_en.md",sourceDirName:"core/server",slug:"/core/server/how_to_build_a_hello_world_application_with_koa_en",permalink:"/blog/docs/core/server/how_to_build_a_hello_world_application_with_koa_en",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/core/server/how_to_build_a_hello_world_application_with_koa_en.md",version:"current",frontMatter:{}},u=[{value:"Introduction",id:"introduction",children:[]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Step 1 \u2014 Setting Up the Project",id:"step-1--setting-up-the-project",children:[]},{value:"Step 2 \u2014 Creating a Koa Server",id:"step-2--creating-a-koa-server",children:[]},{value:"Step 3 \u2014 Adding Routing and View Rendering",id:"step-3--adding-routing-and-view-rendering",children:[]},{value:"Step 4 \u2014 Handling Errors and Responses",id:"step-4--handling-errors-and-responses",children:[]},{value:"Conclusion",id:"conclusion",children:[]}],c={toc:u};function d(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-build-a-hello-world-application-with-koa"},'How To Build a "Hello World" Application with Koa'),(0,r.kt)("h3",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://koajs.com/"},"Koa")," is a new web framework created by the team behind ",(0,r.kt)("a",{parentName:"p",href:"https://expressjs.com/"},"Express"),". It aims to be a modern and more minimalist version of Express."),(0,r.kt)("p",null,"Some of its characteristics are its support and reliance on new JavaScript features such as ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator"},"generators")," and ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"},"async/await"),". Koa also does not ship with any middleware though it can be extended using custom and existing plugins."),(0,r.kt)("p",null,"In this article, you will learn more about the Koa framework and build an app to get familiar with its functionality and philosophy."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"If you would like to follow along with this article, you will need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Node.js installed locally, which you can do by following ",(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorial_series/how-to-install-node-js-and-create-a-local-development-environment"},"How to Install Node.js and Create a Local Development Environment"),"."),(0,r.kt)("li",{parentName:"ul"},"You also need to have a working knowledge of JavaScript and ES6 syntax.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," This tutorial has been revised from Koa 1.0 to Koa 2.0. Refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/koa/blob/master/docs/migration.md"},"migration documentation")," for updating your 1.0 implementations."),(0,r.kt)("p",null,"This tutorial was verified with ",(0,r.kt)("inlineCode",{parentName:"p"},"Node")," v15.14.0, ",(0,r.kt)("inlineCode",{parentName:"p"},"npm")," v7.10.0, ",(0,r.kt)("inlineCode",{parentName:"p"},"koa")," v2.13.1, ",(0,r.kt)("inlineCode",{parentName:"p"},"@koa/router")," v10.0.0, and ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-ejs")," v4.3.0."),(0,r.kt)("h2",{id:"step-1--setting-up-the-project"},"Step 1 \u2014 Setting Up the Project"),(0,r.kt)("p",null,"To begin, create a new directory for your project. This can be done by copying and running the command below in your terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir koa-example\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," You can give your project any name, but this article will be using ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-example")," as the project name and directory."),(0,r.kt)("p",null,"At this point, you have created your project directory ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-example"),". Navigate to the newly created project directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd koa-example\n")),(0,r.kt)("p",null,"Then, initialize your Node project from inside the directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm init -y\n")),(0,r.kt)("p",null,"After running the ",(0,r.kt)("inlineCode",{parentName:"p"},"npm init")," command, you will have a ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json")," file with the default configuration."),(0,r.kt)("p",null,"Next, run this command to install Koa:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install koa@2.13.1\n")),(0,r.kt)("p",null,"Your application is now ready to use Koa."),(0,r.kt)("h2",{id:"step-2--creating-a-koa-server"},"Step 2 \u2014 Creating a Koa Server"),(0,r.kt)("p",null,"First, create the ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file. Then, using your code editor of choice, open the ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file and add the following lines of code:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"'use strict';\n\nconst Koa = require('koa');\nconst app = new Koa();\n\napp.use(ctx => {\n  ctx.body = 'Hello World';\n});\n\napp.listen(1234);\n")),(0,r.kt)("p",null,"In the code above, you created a Koa application that runs on port ",(0,r.kt)("inlineCode",{parentName:"p"},"1234"),". You can run the application using the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"node index.js\n")),(0,r.kt)("p",null,"And visit the application on ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:1234"),"."),(0,r.kt)("h2",{id:"step-3--adding-routing-and-view-rendering"},"Step 3 \u2014 Adding Routing and View Rendering"),(0,r.kt)("p",null,"As mentioned earlier, Koa.js does not ship with any contained middleware and unlike its predecessor, Express, it does not handle routing by default."),(0,r.kt)("p",null,"In order to implement routes in your Koa app, you will install a middleware library for routing in Koa, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/router"},"Koa Router"),"."),(0,r.kt)("p",null,"Open your terminal window and run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @koa/router@10.0.0\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," Previously ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-router")," was the recommended package, but the ",(0,r.kt)("inlineCode",{parentName:"p"},"@koa/router")," is now the officially supported package."),(0,r.kt)("p",null,"To make use of the router in your application, amend your ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"'use strict';\n\nconst Koa = require('koa');\nconst Router = require('@koa/router');\n\nconst app = new Koa();\nconst router = new Router();\n\nrouter.get('koa-example', '/', (ctx) => {\n  ctx.body = 'Hello World';\n});\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods());\n\napp.listen(1234);\n")),(0,r.kt)("p",null,"This code defines a route on the base URL of your application (",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:1234"),") and registers this route to your Koa application."),(0,r.kt)("p",null,"For more information on route definition in Koa.js applications, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/router/blob/master/API.md"},"visit the Koa Router library documentation"),"."),(0,r.kt)("p",null,"As previously established, Koa comes as a minimalistic framework, therefore, to implement view rendering with a template engine you will have to install a middleware library. There are several libraries to choose from but in this article, you will use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/ejs"},"Koa ejs"),"."),(0,r.kt)("p",null,"Open your terminal window and run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install koa-ejs@4.3.0\n")),(0,r.kt)("p",null,"Next, amend your ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file to register your templating with the snippet below:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"'use strict';\n\nconst Koa = require('koa');\nconst Router = require('@koa/router');\nconst render = require('koa-ejs');\nconst path = require('path');\n\nconst app = new Koa();\nconst router = new Router();\n\nrender(app, {\n  root: path.join(__dirname, 'views'),\n  layout: 'index',\n  viewExt: 'html',\n  cache: false,\n  debug: true\n});\n\nrouter.get('koa-example', '/', (ctx) => {\n  ctx.body = 'Hello World';\n});\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods());\n\napp.listen(1234);\n")),(0,r.kt)("p",null,"In your template registering, you defined the root directory of your view files, the extension of the view files, and the base view file ","(","which other views extend",")","."),(0,r.kt)("p",null,"Now that you have registered your template middleware, amend your route definition to render a template file:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ...\n\nrouter.get('koa-example', '/', (ctx) => {\n  let koalaFacts = [];\n\n  koalaFacts.push({\n    meta_name: 'Color',\n    meta_value: 'Black and white'\n  });\n\n  koalaFacts.push({\n    meta_name: 'Native Country',\n    meta_value: 'Australia'\n  });\n\n  koalaFacts.push({\n    meta_name: 'Animal Classification',\n    meta_value: 'Mammal'\n  });\n\n  koalaFacts.push({\n    meta_name: 'Life Span',\n    meta_value: '13 - 18 years'\n  });\n\n  koalaFacts.push({\n    meta_name: 'Are they bears?',\n    meta_value: 'No'\n  });\n\n  return ctx.render('index', {\n    attributes: koalaFacts\n  });\n})\n\n// ...\n")),(0,r.kt)("p",null,"Your base route renders the ",(0,r.kt)("inlineCode",{parentName:"p"},"index.html")," file found in the ",(0,r.kt)("inlineCode",{parentName:"p"},"views")," directory."),(0,r.kt)("p",null,"Now, create this directory and file. The open ",(0,r.kt)("inlineCode",{parentName:"p"},"index.html")," and add the following lines of code:"),(0,r.kt)("p",null,"views/index.html"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<h2>Koala - a directory Koala of attributes</h2>\n<ul class="list-group">\n  <% attributes.forEach( function(attribute) { %>\n    <li class="list-group-item">\n      <%= attribute.meta_name %> - <%= attribute.meta_value %>\n    </li>\n  <% }) %>\n</ul>\n')),(0,r.kt)("p",null,"Now, when running the application and observing it in a web browser will display the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"OutputKoala - a directory Koala of attributes\nColor - Black and white\nNative Country - Australia\nAnimal Classification - Mammal\nLife Span - 13 - 18 years\nAre they bears? - No\n")),(0,r.kt)("p",null,"For more options with using the ",(0,r.kt)("inlineCode",{parentName:"p"},"koa-ejs")," template middleware, ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/ejs"},"visit the library documentation"),"."),(0,r.kt)("h2",{id:"step-4--handling-errors-and-responses"},"Step 4 \u2014 Handling Errors and Responses"),(0,r.kt)("p",null,"Koa handles errors by defining an error middleware early in your entry point file. The error middleware must be defined early because only errors from middleware defined after the error middleware will be caught."),(0,r.kt)("p",null,"Using your ",(0,r.kt)("inlineCode",{parentName:"p"},"index.js")," file as an example, make the following changes to the code:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"'use strict';\n\nconst Koa = require('koa');\nconst Router = require('@koa/router');\nconst render = require('koa-ejs');\nconst path = require('path');\n\nconst app = new Koa();\nconst router = new Router();\n\napp.use(async (ctx, next) => {\n  try {\n    await next()\n  } catch(err) {\n    console.log(err.status)\n    ctx.status = err.status || 500;\n    ctx.body = err.message;\n  }\n});\n\n// ...\n")),(0,r.kt)("p",null,"This block of code will catch any error thrown during the execution of your application."),(0,r.kt)("p",null,"You can test this by throwing an error in the function body of the route you defined:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ...\n\nrouter.get('error', '/error', (ctx) => {\n  ctx.throw(500, 'internal server error');\n});\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods());\n\napp.listen(1234);\n")),(0,r.kt)("p",null,"Now, when running the application and observing ",(0,r.kt)("inlineCode",{parentName:"p"},"/error")," in a web browser will display the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Outputinternal server error\n")),(0,r.kt)("p",null,"The Koa response object is usually embedded in its context object. Using route definition, let\u2019s show an example of setting responses:"),(0,r.kt)("p",null,"index.js"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// ...\n\nrouter.get('status', '/status', (ctx) => {\n  ctx.status = 200;\n  ctx.body   = 'ok';\n})\n\napp\n  .use(router.routes())\n  .use(router.allowedMethods());\n\napp.listen(1234);\n")),(0,r.kt)("p",null,"Now, when running the application and observing ",(0,r.kt)("inlineCode",{parentName:"p"},"/status")," in a web browser will display the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Output\nok\n")),(0,r.kt)("p",null,"Your application now handles errors and responses."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"In this article, you had a brief introduction to Koa and how to implement some common functionalities in a Koa project. Koa is a minimalist and flexible framework that can be extended to more functionality than this article has shown. Because of its futuristic similarity to Express, some have even described it as Express 5.0 in spirit."))}d.isMDXComponent=!0}}]);